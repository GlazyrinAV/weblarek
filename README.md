# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные
#### Интерфейс IProduct
`id: string;` - уникальный идентификатор товара;

`description: string;` - описание товара;

`image: string;` - ссылка на изображение товара;

`title: string;` - название товара;

`category: string;` - категория товара;

`price: number | null;` - цена товара, которая может быть равна null, если товар не доступен для покупки;

#### Интерфейс IProductList
`products: IProduct[];` - массив товаров;

`total: number;` - общее количество товаров;

#### Интерфейс IBuyer
`payment: TPayment;` - вид оплаты;

`email: string;` - адрес электронной почты Покупателя;

`phone: string;` - телефон Покупателя;

`address: string;` - адрес доставки Покупателя.

#### Интерфейс IValidationResult
`[key: string]: string` - набор полей, которые содержат ошибку с её описанием

#### Интерфейс IOder
Содержит поля `IBuyer;`, а также дополнительное поле: 

`total: number;` - общая стоимость товаров, которые были выбраны для покупки;

`products: String[];` - массив Id товаров, которые были выбраны для покупки.

#### Интерфейс IOrderSuccess
`orderId: string;` - уникальный идентификатор заказа;

`message: string;` - сообщение о результате заказа.

### Модель данных
#### Класс Product
Предназначен для хранения следующих данных:
- массива всех товаров;
- товара, выбранного для подробного отображения.

Методы:

`setAll(products: IProduct[]): void` - сохранение массива товаров полученного в параметрах метода. 
Формирует событие `product:receivedCatalog`;

`getAll(): IProduct[]` - получение массива товаров из модели;

`getById(id: string): IProduct | null` - получение одного товара по его id;

`setCurrentProduct(product: IProduct): void` - сохранение товара для подробного отображения. 
Формирует событие `product:chosenCurrent`;

`getCurrentProduct(): IProduct | null` - получение товара для подробного отображения.

#### Класс Cart
Предназначен для хранения данных о товарах, которые пользователь выбрал для покупки.

Методы:

`getAll(): IProduct[]` - получение массива товаров, которые находятся в корзине;

`set(data: IProduct[]): void` - добавление товара, который был получен в параметре, в массив корзины. 
Формирует событие `cart:change`;

`remove(id: string): void` - удаление товара, полученного в параметре из массива корзины.
Формирует событие `cart:change`;

`clear(): void` - очистка корзины. Формирует событие `cart:empty`;

`getTotalPrice(): number` - получение стоимости всех товаров в корзине;

`getTotalCount(): number` - получение количества товаров в корзине;

`isProductInCart(id: string): boolean` - проверка наличия товара в корзине по его id, полученного в параметр метода.

#### Класс Buyer
Хранит и обрабатывает данные о покупателе, а именно:
- вид оплаты;
- адреc;
- телефон;
- адрес электронной.

Методы:

`set(buyer: Partial<IBuyer>): void` - сохранение данных в модели. Метод позволяет произвести частичное сохранение данных.
Формирует события `buyer:changeOrder` (изменение способа оплаты или адреса) и `buyer:changeContacts` (изменение телефона или почты).

`getAll(): IBuyer` - получение всех данных покупателя;

`clear(): void` - очистка данных покупателя. Формирует событие `buyer:empty`;

`validate(): IValidationResult` - валидация данных. Поле является валидным, если оно не пустое. 
Метод предоставляет информацию об найденных ошибках валидации в виде объекта, содержащего описание каждой ошибки.

### Слой коммуникации
#### Класс ProductController
Осуществляет запрос на сервер с помощью метода `get` класса Api и будет получать с сервера объект с массивом товаров и 
отправляет с помощью метода `post` класса Api данные о покупателе и выбранных товарах.

`findAll(): Promise<IProduct[]>` - получение массива доступных товаров;

`save(buyer: IBuyer, products: IProduct[]): Promise<IOrderResult>` - отправка данных о покупателе и выбранных товарах на сервер.

### Слой представления
#### Класс Header
Отвечает за создание шапку сайта.

Данные должны соответствовать IHeaderData:
`counter: number` - число элементов, которое входит в корзину;

Класс состоит из следующих полей:
- `basketButton: HTMLButtonElement` - кнопка открытия окна корзины, при нажатии на которую создается событие `header:basket`;
- `counterElement: HTMLElement` - элемент, содержащие значение количества добавленных в корзину элементов;

Методы:
- `set counter(value: number): void` - установление нового значения счетчика у корзины;

#### Класс Gallery
Отвечает за создание набора карточек.

Данные должны соответствовать IGalleryData:
`catalog: HTMLElement[];` - массив элементов, содержащих карточки.

Класс состоит из следующих полей:
`catalogElement: HTMLElement;` - контейнер со всеми карточкам.

Методы:
`set catalog(items: HTMLElement[]): void` - обновление списка карточек

#### Класс Modal
Отвечает за создание всплывающих окон с заданным контентом

Данные должны соответствовать IModalData:
`content: HTMLElement` - содержимое модального окна

Класс состоит из следующих полей:
- `closeButton: HTMLButtonElement;` - кнопка закрытия модального окна, при нажатии формирует событие `modal:closeButton`;
- `modalElement: HTMLElement` - модальное окно, при нажатии (т.е. за пределами блока с содержимым) формирует событие `modal:closeButton`;;
- `contentElement: HTMLElement` - содержимое модального окна.;

Методы:
`set content(content: HTMLElement): void` - устанавливает содержимое модального окна;
`get content(): HTMLElement` - получение содержимого модального окна;
`closeModal(): void` - закрытие модального окна;
`clear(): void` - удаление содержимого модального окна.

#### Класс Basket
Отвечает за создание корзины выбранных карточек

Данные должны соответствовать IBasketData:
- `content: HTMLElement[]` - список добавленных карточек;
- `total: string` - общая стоимость добавленных карточек.

Класс состоит из следующих полей:
- `basketElement: HTMLUListElement` - блок содержащий все добавленные в корзину карточки;
- `totalPriceElement: HTMLElement` - элемент, отображающий общую стоимость выбранных карточек;
- `makeOderButton: HTMLButtonElement` - кнопка оформления заказа, при нажатии формируется событие `order:new`.

Методы:
- `set content(items: HTMLElement[]): void`- установить новый состав корзины;
- `set total(total: number):void `- изменить сумму добавленных карточек.

#### Класс Card
Абстрактный класс карточки. 

Класс состоит из следующих полей:
- `titleElement: HTMLElement` - элемент с названием карточки;
- `priceElement: HTMLElement` - элемент с ценой карточки;

Методы:
- `set title(title: string):void` - указание названия карточки;
- `set price(price: number):void` - указание цены карточки;
- `set id(id: string):void` - указание ID в датасете карточки.

С его помощью создаются следующие виды карточек:

##### Класс CardPreview
Отвечает за создание карточки с подробной информацией о ней.

Данные должны соответствовать `ICardPreviewData`:
- `id: string` - id карточки;
- `category: string` - категория карточки;
- `title: string` - название карточки;
- `description: string` - описание карточки;
- `image: string` - путь к изображению;
- `alt: string | null` - альтернативная информация о картинке;
- `price: number | null` - цена карточки;

Класс состоит из следующих полей:
- `categoryElement: HTMLElement` - элемент для хранения категории карточки;
- `imageElement: HTMLImageElement` - элемент для хранения изображения;
- `descriptionElement: HTMLElement` - элемент для хранения описания карточки;
- `cardButton: HTMLButtonElement` - кнопка для добавления карточки в корзину или её удаления, 
если она уже в корзине (формируется событие `card:buttonAction`).

Методы:
- `set category(category: string):void` - указание категории карточки;
- `set image(src: string):void` - указание данных об изображении карточки;
- `set description(text: string):void` - указание описание карточки;
- `changeButtonToRemove(): void` - замена данных кнопки на удаление из корзины;
- `disablePurchaseButton(): void` - отключение возможности покупки карточки.

##### Класс CardCatalog
Отвечает за создание карточки с подробной информацией о ней.

Данные должны соответствовать ICardCatalogData:
- `id: string` - id карточки;
- `category: string` - категория карточки;
- `title: string` - название карточки;
- `image: string` - путь к изображению;
- `alt: string | null` - альтернативная информация о картинке;
- `price: number | null` - цена карточки;

Класс состоит из следующих полей:
- `categoryElement: HTMLElement` - элемент для хранения категории карточки;
- `imageElement: HTMLImageElement` - элемент для хранения изображения;
- `cardButton: HTMLButtonElement` - карточка представлена в виде кнопки, при нажатии формируется событие `card:open`.;

Методы:
- `set category(category: string):void` - указание категории карточки;
- `set image(src: string):void` - указание данных об изображении карточки.

##### Класс CardBasket
Отвечает за создание карточки, которая добавлена в корзину

Данные должны соответствовать ICardBasketData:
- `id: string` - id карточки;
- `index: number` - порядковый номер карточки в корзине;
- `title: string` - название карточки;
- `price: number | null` - цена карточки;

Класс состоит из следующих полей:
- `indexElement: HTMLElement` - порядковый номер карточки в корзине;
- `deleteButton: HTMLButtonElement` - кнопка для удаления карточки из корзины, формирует событие `card:removeButton`;

Методы:
- `set index(index: number):void` - указание индекса карточки.

#### Класс OrderForm
Абстрактный класс формы оформления заказа.

Класс состоит из следующих полей:
- `errorsElement: HTMLElement` - вывод ошибок заполненности обязательных полей;
- `orderButton: HTMLButtonElement` - кнопка следующего шага оформления заказа. 
При нажатии в классе Order формирует событие `contacts:new`, в классе Contacts - `order:send`.

Методы:
- `set errors(errors: string[]):void` - указывает текст ошибок при их наличии 
и управляет доступом к кнопке перехода на следующий этап.
- `activeButton(): void` - сделать кнопку активной;
- `deActiveButton(): void` - сделать кнопку недоступной;
- `checkErrors(errors: string[]): void` - внутренний метод класса 

С его помощью создаются следующие варианты форм:

##### Класс Order
Отвечает за создание части заказа, в которой указывается информация о способе оплаты и адрес доставки

Данные должны соответствовать IOrderData:
- `payment: TPayment | null` - вид платежа;
- `address: string | null` - адрес доставки заказа;

Класс состоит из следующих полей:
- `cardButton: HTMLButtonElement` - кнопка выбора платежа с помощью карты, формирует событие `order:card`;
- `cashButton: HTMLButtonElement` - кнопка выбора платежа с помощью наличности, формирует событие `order:cash`;
- `addressElement: HTMLInputElement` - поле для ввода адреса, формирует событие `contacts:new`;

Методы:
- `set address(address: string): void` - определение адреса доставки;
- `set payment(payment: TPayment): void` - определение способа оплаты;
- `get address(): string` - получение введенного адреса.

##### Класс Contacts
Отвечает за заполненную часть информации о заказчике.

Данные должны соответствовать IContactsData:
- `email: string | null` - электронная почта клиента;
- `phone: string | null` - контактный телефон клиента;

Класс состоит из следующих полей:
- `emailElement: HTMLInputElement` - поле для ввода электронной почты, формирует событие `order:email`;
- `phoneElement: HTMLInputElement` - поле для ввода контактного телефона, формирует событие `order:phone`;

Методы
- `set email(email: string): void` - определение почты;
- `set phone(phone: string): void` - определение телефона;
- `get email(): string` - получение введенной почты;
- `get phone(): string` - получение введенного телефона.

#### Класс OrderResult
Отвечает за создание окна успешной отправки заказа

Данные должны соответствовать IOrderResult:
`total: number` – итоговая стоимость заказанных продуктов;

Класс состоит из следующих полей:
- `descriptionElement: HTMLElement` - элемент с описанием результата;
- `closeButton: HTMLButtonElement` - кнопка для закрытия данного окна, формирует событие `result:ok`;

Методы:
`set total(total: number):void` - указание текста сообщения.

### Presenter
Реализует реакцию на следующие события:

- `product:receivedCatalog` - после получения Моделью каталога карточек отрисовывает их;
- `card:open` - выбирает в Модели текущий товар;
- `product:chosenCurrent` - отрисовывает подробную карточку товара после выбора в Модели текущего товара;
- `modal:closeButton` - при клике на кнопку закрытия или за границы объекта закрывает модальное окно;
- `card:buttonAction` - в зависимости от типа кнопки добавляет или удаляет из Корзины карточку;
- `header:basket` - отрисовка корзины при нажатии на значок корзины;
- `card:removeButton` - удаление карточки из Корзины при нажатии на значок удаления внутри корзины;
- `cart:change` - если изменение Корзины происходит при открытой корзине - 
перерисовка корзины, в противном случае - закрытие модального окна;
- `order:new` - отрисовка окна нового заказа при нажатии на кнопку оформить;
- `order:card` - в Модели обновляется тип платежа на карточку;
- `order:cash` - в Модели обновляется тип платежа на наличный расчет;
- `order:address` - в Модели обновляется адрес доставки;
- `order:email` - в Модели обновляется электронная почта;
- `order:phone` - в Модели обновляется контактный телефон;
- `order:send` - после нажатия кнопки оплаты происходит формирование запроса на сервер, 
получение ответа, отрисовка окна результата, очистка Корзины и Заказа;
- `buyer:changeOrder` - перерисовка окна заказа при изменении вида оплата или адреса;
- `buyer:changeContacts` - перерисовка окна заказа при изменении телефона или почты;
- `contacts:new` - отрисовка окна с контактными данными при нажатии кнопки продолжения оформления;
- `result:ok` - при нажатии кнопки продолжить покупки закрывает модальное окно;
- `cart:empty` - обновляет счетчик корзины при очистке Корзины;